---
layout: post
tags:
  - 开发者手册
  - 效率编程
  - Linux
---

## 背景介绍

作为一个后端程序员,经常要和别人联调接口,每当这时,总是被公司的各种,`dev,qa,pre,prod`环境搞得头疼,,,我真的只是想简单的联调一下看看能不能调的通啊...或者当你为移动端开发接口的时候,你想完整的体验从点击APP到自己的电脑打出log这个流程(因为中间好几个环境,你需要知道是哪里出了问题),却发现自己的办公网络没有独立ip....那么你可以来学习一下Linux的端口转发了.

## 将本地的请求转发到远程主机端口

这个方案主要用来解决访问生产环境的问题.(当然这样不好,但是有些生产环境不重要,可以这样操作)

举个简单的例子,你在本地执行:

```shell

ssh -L 4333:localhost:8000 root@xxxxx -N -f

```

可以将本地的4333端口转发到远程的8000端口,这意味着你在本地调用`localhost:4333`即可以获取到`xxxxx`服务器上`8000`端口的结果.

现在举个复杂一点的例子:


比如你现在在本地测试代码,我们成为:localhost.

你要连接一个生产的数据库,本地连接不上. 生产的数据库称为:prod.

但是你现在有一台dev机,称为dev.

在dev机器上可以访问到一个跳板机,我们称之为jump.

那么怎么样才可以在本地运行并且连接到prod的数据库呢?

需要在dev机上端口转发.

在dev机上执行:

```shell

ssh -L 3333:prod:3306 root@jump -N -f

```

这个命令的结果是:

所有请求dev机3333端口的请求,都会被转发为jump机器上对`prod:3306`的请求.

现在在本地直接执行`mysql -uroot -p -hdev -P3333`就可以连接`prod`的数据库了,当然,用户和密码都需要是真实的线上数据库的用户和密码.


## 将远程主机端口的请求转发到本地

这个案例就是用来解决内网穿透的问题了,当然你也可以选择搭建`ngrok`服务器,只是更麻烦一些.

假如你和移动端同学py一下,让他们给你打个包用来测试,绑定一个测试服务器,那么最好的当然是绑定我们的本地机器,这样随时随地可以测试.但是我们日常使用wifi,ip地址经常会变,这可怎么办呢?

随便找一台具有固定ip的服务器,最好是公司的测试服务器不用的端口即可.

然后在本地执行:

```shell

ssh -R 8092:localhost:6666 root@xxxxx -N -f

```

即可以将对`xxxxx`服务器8092端口的访问转发到本地的6666端口上,现在你可以让请求API的人直接请求`xxxxxx:8092`,而你在本地的6666端口上启动服务即可,不仅可以随时修改随时起效,还可以打断点调试.


## 参考文章

https://blog.fundebug.com/2017/04/24/ssh-port-forwarding/

## 联系我
最后，欢迎关注我的个人公众号【 呼延十 】，会不定期更新很多后端工程师的学习笔记。
也欢迎直接公众号私信或者邮箱联系我，一定知无不言，言无不尽。
![](http://img.couplecoders.tech/%E6%89%AB%E7%A0%81_%E6%90%9C%E7%B4%A2%E8%81%94%E5%90%88%E4%BC%A0%E6%92%AD%E6%A0%B7%E5%BC%8F-%E6%A0%87%E5%87%86%E8%89%B2%E7%89%88.png)

<br>
<br>
<br>
<br>
<h4>ChangeLog</h4>
2019-05-12      完成
<br>
<br>


**以上皆为个人所思所得，如有错误欢迎评论区指正。**

**欢迎转载，烦请署名并保留原文链接。**

**联系邮箱：huyanshi2580@gmail.com**

**更多学习笔记见个人博客------><a href="{{ site.baseurl }}/">呼延十</a>**
