---
layout: post
category: [Redis]
tags:
  - Redis
---

## 前言

面试题回忆: <font color="red">Redis的hash结构,底层所使用的的内存结构是 hash表. Redis的hash表在rehash的时候与Java的HashMap的rehash过程有何不同?</font>

真是痛苦的回忆啊.

众所周知, Redis是一个使用ANSI C编写的开源、支持网络、基于内存、可选持久性的键值对存储数据库。 最常见的应用场景就是用来做缓存了.

得益于Redis优秀的性能以及简单的上手难度, 它在当前的互联网公司内应用及其广泛, 这也导致了它是面试的一大重难点.

基于此, 我们有必要,认真的去学习Redis的更多使用姿势及其底层实现原理,一来可以让我们开发时使用的更加得心应手,二来可以让我们的面试无往不利.

这将是我学习Redis的第一篇记录,主要记录Redis的基础数据结构及其底层实现原理.

## 基本的数据结构

市面上的很多教程, 讲解, 依然在沿用Redis有五种基本数据结构, 但是根据最新的官网来看, Redis拥有的远不止这些.

>It supports data structures such as strings, hashes, lists, sets, sorted sets with range queries, bitmaps, hyperloglogs, geospatial indexes with radius queries and streams

* 字符串
* 列表
* 集合
* 支持范围查询的有序集合
* 散列
* 位图
* hyperloglogs(没有官方翻译名字,直接用英文名)
* 支持半径查询的地理空间索引
* Streams

接下来我将简单介绍一下,这些数据结构的作用. 具体对应的命令集及其示例, 可以在 [Redis命令全集](http://huyan.couplecoders.tech/redis/2019/04/04/Redis%E5%91%BD%E4%BB%A4%E5%85%A8%E9%9B%86/) 查看.

* 字符串
使用Redis最常使用的数据结构,一个简单的字符串,直接get/set等操作.
* 列表
列表是一个有序的字符串列表,大致上相当于Java中的双向LinkedList. 
* 集合
一个不允许有重复值的字符串集合.
* 有序集合
对字符串集合添加了score属性,可以在Redis内部保持值的有序性.
* 散列
一个散列内可以保存多个kv值.类似于Java的hashmap.
* 位图
等价于经典意义上的位图,只是在Redis中其实是对字符串数据结构的一个具体应用.
* hyperloglogs
一个用来做基数统计的算法,优点在于只统计唯一的值的数量而不存储值本身, 因此可以使用极小的内存来统计大量的数据,我们可以应用它来计算日活等.
* 地理空间索引
可以对二维空间上的某个地理位置进行索引,以此进行半径查询, 内部使用了Sorted Set来存储数据, 实现用的算法是经典的geohash.
* streams
一个类似于kafka, 但是更加轻量级, 极少运维成本的一个消息队列, 而且比Redis自身的pubsub要靠谱的多. 我们团队将它用在内部的一些数据改动的更新上.

## Redis对象系统

Redis并不是像我们想象的那样粗暴的按照上面的几种数据结构进行存储.而是别有一番精妙的设计,它设计了一个对象系统.

上面的每一个数据结构,在Redis中都是一个对象, 比如字符串, 就是一个字符串对象,至于字符串对象怎么实现, 底层到底是用什么来保存的数据, 那是被封装到对象中的细节. 也是因此, 可以进行更多的底层更改而不必频繁更改字符串数据结构的对外API.

设想一下, 当你在一个字符串中存储 `10`这个数字, 和 一个`值是这篇文章`的字符串,Redis真的会用同一种方式来进行存储吗?

所以Redis所谓的KV型数据库, K永远是一个字符串对象, V是上面的某一种对象.

此外, 对象系统也为其他方面提供了遍历,简单总结如下:

* 封装具体对象的实现细节,有更多优化,细致处理的可能.
每一个对象的底层实现, 可以是很复杂,多场景的,只需要对外暴露统一的API即可.
* 方便的进行类别判断.
如果对字符串对象进行`LPUSH`操作会怎么样? Redis会机智的识别到待操作类型错误.
* Redis对象系统实现了基于引用计数的垃圾回收算法.
可以在对象不再使用的时候自动释放内存.
* 在实现引用计数的同时,实现了对象内存共享机制.
在适当的条件下, 多个键值可以共享同一个值, 来节省内存.
* 淘汰策略中计算key的空转时长
在对象系统上,记录了key的访问时间,当需要进行内存淘汰的时候, 空转时长较大的键值可能会优先被服务器删除.

## 底层数据结构














## 大纲

1. 多种基本类型
2. 多种底层数据结构
3. 对象系统.

## 参考链接

《Redis设计与实现(第二版》

[Redis官网](https://redis.io/)

[Redis中文官网](https://redis.cn/)



<br>


完。
<br>
<br>
<br>
<br>
<h4>ChangeLog</h4>
2019-05-19 完成
<br>
<br>


![](http://img.couplecoders.tech/%E6%89%AB%E7%A0%81_%E6%90%9C%E7%B4%A2%E8%81%94%E5%90%88%E4%BC%A0%E6%92%AD%E6%A0%B7%E5%BC%8F-%E6%A0%87%E5%87%86%E8%89%B2%E7%89%88.png)


**以上皆为个人所思所得，如有错误欢迎评论区指正。**


**欢迎转载，烦请署名并保留原文链接。**


**联系邮箱：huyanshi2580@gmail.com**


**更多学习笔记见个人博客或关注微信公众号<呼延十>------><a href="{{ site.baseurl }}/">呼延十</a>**